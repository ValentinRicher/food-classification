#  Food classification

Personal project for image classification on Food-101 dataset.  
This project has 2 goals :
- Optimize training time with TF Profiler -> DONE. I divided by 3 training times.
- Get best performance on Food-101 dataset using transfer learning and fine-tuning techniques based on papers in references.txt. -> IN PROGRESS.
- Intelligibility of the decisions taken by the algorithm. -> TODO.

# Setup 

Create a virtual environment and install librairies in `requirements.txt`

# Project organization

## Overview

- `src` contains all the code for the project.
- `tests` contains all the tests for the project.
- `notebooks`: all the notebooks for implementing quickly. This folder is separated from `src` because it should not used for production.
- `doc`: documentation generated by Sphinx.
  
## `src` folder

### `src/application`

All the files to launch the application like the training or the prediction. These files call other files defined in other folders. This folder is here to centralized the different entry points of the project.  
Here there are different training possibilities if you want to train on Azure or on an on-premise server. The two files or entry points will call the same training pipeline.  

- `src/application/train_local.py` is an entry point for the project. You specify the tracking URI and the experiment name for MLflow. The experiment name is also used in the `src/pipelines/mlflow_train_pipeline.py` file to choose the right model.
- `src/application/predict_from_served_model.py` can call a model served with MLflow format locally or on Azure. The images need to be encoded in base 64 before being sent over HTTP. Then the images are stored in pandas DataFrame as required by MLflow. 

### `src/classifiers`

All the models defined as classes :
- EfficientNetB0
- EfficientNetB4
- MobileNetV2
- Xception
These models are defined as classes for standardization purposes. They inherit from the KerasClassifier class that inherits from the Classifier class.

### `src/pipelines` 

The pipelines that organize the training :
- `src/pipelines/mlflow_train_pipeline.py` to train the models logging in MLflow and saving the models as MLflow format.
- `src/pipelines/train_pipeline.py` to train without MLflow for quick testing and debugging for example.

### `src/settings`

This project uses a settings folder in [src/settings](../../src/settings/).  

The file `settings.py` defines all the variables that will be imported in the other files.
It has several purposes :
- To centralize the variables, dictionaries that can be imported in other files so that every file share the same values;
- To abstract the way these variables are defined either dictionaries or others;
- To hide the organization of the settings whatever the environment;
- To make import of settings simpler and elegant like importing modules in one line of code instead of loading each file containing variables in several lines of code in each file where the variables are needed.
  
Furthermore, it standardizes the logs. In this file you can define the levels of logs you need.  

The settings will load the variables that are common to all the environments. These variables are set in the folder `settings/common`. For example the models parameters.  
The settings will also load the variables according to the environment in which you work. To do so it defines the `ENV` variable which defines the folder where to find these variables. For example if you work locally on your computer you can create a folder `local-mac` and put all the paths to find the models or the datasets for example. 

### `src/tools`

All the utility files that are reused across the project.

## `tests` folder

- `tests/load_tests` : tests for the model served and the application;
- `tests/unit_tests` is a replica of `src` containing all the unit test for the project in `src`;
- `tests/test_images`: images used for the tests.

# Problem presentation

# Benchmark

https://paperswithcode.com/sota/fine-grained-image-classification-on-food-101
https://github.com/stratospark/food-101-keras

# Results

# How to 


![coverage](./coverage.svg)